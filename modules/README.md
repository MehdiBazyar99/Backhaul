# EasyBackhaul Modules

This directory contains the modular Bash script components that form the EasyBackhaul utility. The main `easybh.sh` script is generated by concatenating these modules using the `../build.sh` script.

This modular approach helps in organizing the codebase, making it easier to maintain, debug, and extend functionalities.

## Module Overview

Below is a list of the current modules and their primary responsibilities:

-   **`globals.sh`**: Defines global variables, constants, default paths, and initial configuration settings used throughout the script.
-   **`helpers.sh`**: A comprehensive utility library providing common functions for printing colored/iconized messages, logging, error handling, input validation (IPs, ports, names), network checks (port availability, netcat compatibility, connectivity), system resource monitoring, performance tracking, secure file operations, configuration backups, process/watcher cleanup, menu system components (headers, footers, input loops), spinner for long operations, and TLS certificate generation.
-   **`backhaul_core.sh`**: Handles the core logic related to the Backhaul binary itself, including downloading the latest version from GitHub (or alternative sources), installing it, and verifying the installation. Also includes fetching server IP and geo-information.
-   **`config.sh`**: Manages the creation and modification of tunnel configurations. It features a guided wizard (`configure_tunnel`) for setting up new tunnels (server/client modes, various protocols) and saves these as per-tunnel TOML files.
-   **`validation.sh`**: Provides functions for validating the syntax and content of tunnel TOML configuration files, including protocol-specific checks and advanced parameter validation.
-   **`ufw.sh`**: Manages UFW (Uncomplicated Firewall) rules. It allows adding and deleting rules for specific tunnels based on comments, and includes a menu for general UFW status management, enabling/disabling, and resetting rules.
-   **`systemd.sh`**: Responsible for creating and managing systemd service files for each Backhaul tunnel, enabling them to run as persistent background services.
-   **`cron.sh`**: Manages cron jobs for automatically restarting tunnel services at configured intervals, enhancing tunnel reliability.
-   **`restart_watcher.sh`**: Implements the coordinated restart watcher functionality. It includes the core logic for the background watcher process (log monitoring, netcat communication) and UI functions for enabling, disabling, configuring, and testing the watcher for each tunnel.
-   **`tunnel_mgmt.sh`**: Provides the user interface for listing and managing existing tunnels. Users can select a tunnel to perform operations like start, stop, restart, view logs, edit configuration, manage its watcher, test connections, and delete the tunnel.
-   **`menu.sh`**: Contains the main entry point of the EasyBackhaul script (`main_script_entry_point`), the primary user menu (`main_menu_entry`), the initial installation wizard (`_initial_installation_wizard`), the system health monitor UI (`system_health_monitor_menu`), and the uninstallation logic (`_perform_full_uninstall`). It orchestrates the overall script flow and navigation.

---

*To rebuild `easybh.sh` after modifying any module, run `../build.sh` from the repository root.*
