# EasyBackhaul: اسکریپت نصب و مدیریت آسان Backhaul

![Version](https://img.shields.io/badge/Version-14.0--dev-blue.svg)
![License](https://img.shields.io/badge/License-AGPL--3.0-brightgreen.svg)
![Maintained](https://img.shields.io/badge/maintained%3F-yes-green.svg)
![Features](https://img.shields.io/badge/Features-مدیریت%20پیشرفته%20%7C%20ریستارت%20هوشمند%20%7C%20اعتبارسنجی%20بهبود%20یافته%20%7C%20نظارت%20بر%20سلامت%20سیستم-orange.svg)

[**English Document (نسخه انگلیسی)**](./README.md)

به **EasyBackhaul** خوش آمدید! یک اسکریپت ماژولار، کاربرپسند و قدرتمند برای مدیریت [Backhaul](https://github.com/Musixal/Backhaul). این ابزار نصب، پیکربندی و مدیریت روزانه بک‌هاول را بسیار ساده و سریع می‌کند.

توسعه یافته توسط [@N4Xon (NaxonM)](https://github.com/NaxonM/EasyBackhaul)، EasyBackhaul یک رابط منویی قوی برای مدیریت پروژه اصلی بک‌هاول (Musixal) فراهم می‌کند.

---

## 🛠️ نصب و شروع سریع

**نصب سریع (پیشنهادی):**  
اجرای مستقیم اسکریپت از گیت‌هاب با یک دستور:

```bash
bash <(curl -Ls https://raw.githubusercontent.com/NaxonM/EasyBackhaul/dev/easybh.sh)
```

**از سورس:**  
مخزن را کلون و اسکریپت را از سورس بسازید:

```bash
git clone https://github.com/NaxonM/EasyBackhaul.git
cd EasyBackhaul
./build.sh
sudo bash easybh.sh
```

---

## 🚀 امکانات

### **مدیریت اصلی**
- **ساختار ماژولار**: نگهداری و توسعه آسان از طریق پوشه `modules/` و اسکریپت `build.sh`
- **جادوگر پیکربندی راهنما**: برای سرور و کلاینت، با راهنمای متنی در هر مرحله
- **نمایش لاگ تعاملی**: اسکرول، جستجو و دنبال‌کردن لاگ زنده — خروج امن با Ctrl+C
- **مدیریت خودکار وابستگی‌ها، UFW و systemd**
- **مدیریت گواهی TLS**: تولید و استفاده از گواهی خودامضا برای تونل‌های امن

### **امکانات پیشرفته**
- **ریستارت هوشمند**: ریستارت هماهنگ با بررسی سلامت، نظارت بر منابع و بازیابی خطا
- **اعتبارسنجی پیشرفته کانفیگ**: اعتبارسنجی جامع با گزارش‌دهی دقیق خطاها
- **ناظر ریستارت هماهنگ**: هماهنگی پیشرفته ریستارت بین کلاینت و سرور
- **راه‌اندازی خودکار با کرون**: تنظیم یا حذف کرون‌جاب برای پایداری بیشتر
- **نظارت بر عملکرد**: پیگیری عملکرد عملیات و استفاده از منابع
- **نظارت بر سلامت**: بررسی‌های سلامت تونل در زمان واقعی با نظارت بر منابع
- **نظارت بر سلامت و عملکرد سیستم**: نظارت جامع سیستم و بهینه‌سازی
- **پاک‌سازی فرآیندهای زامبی**: پاک‌سازی خودکار فرآیندهای یتیم و ناظران

### **تجربه کاربری**
- **مدیریت پیشرفته خطا**: پیام‌های واضح و رنگی با پیش‌فرض‌های امن
- **شاخص‌های پیشرفت**: بازخورد بصری برای عملیات طولانی با انیمیشن‌های چرخشی
- **اعتبارسنجی ورودی**: اعتبارسنجی قوی با درخواست مجدد برای ورودی نامعتبر
- **راهنمای متنی**: فشار دادن `?` برای راهنما در سراسر رابط
- **مستندات دو زبانه**: انگلیسی و فارسی
- **کانال توسعه**: دریافت آخرین امکانات پیش از انتشار پایدار
- **جادوگر نصب**: گزینه‌های متعدد نصب با تشخیص شبکه

### **امنیت و عملکرد**
- **عملیات امن فایل**: حذف امن و سخت‌سازی مجوزها
- **بهینه‌سازی منابع**: بهینه‌سازی اولویت فرآیند و مدیریت حافظه
- **محدودیت نرخ**: محافظت در برابر عملیات سریع
- **پاک‌سازی ورودی**: مدیریت امن ورودی کاربر
- **چرخش لاگ**: مدیریت خودکار لاگ و چرخش
- **سخت‌سازی مجوزها**: سخت‌سازی خودکار امنیت فایل‌های کانفیگ و پوشه‌ها

### **ثبت و نظارت**
- **سیستم ثبت پیشرفته**: فرمت‌های JSON و متنی با سطوح قابل تنظیم
- **مدیریت سطح لاگ**: تغییرات پویای سطح لاگ (debug/info/warn/error)
- **ثبت سلامت**: فایل‌های لاگ اختصاصی سلامت و عملکرد
- **ثبت حسابرسی**: مسیر حسابرسی جامع تمام عملیات
- **نمایشگر فایل لاگ**: مرور تعاملی فایل‌های لاگ با قابلیت جستجو

---

## 📝 راهنمای استفاده: گام به گام

### ۱. جادوگر نصب

اسکریپت با جادوگر نصب شروع می‌شود که گزینه‌های متعددی ارائه می‌دهد:
- **دانلود خودکار از گیت‌هاب** (پیشنهادی): دانلود آخرین باینری Backhaul از گیت‌هاب
- **نصب از فایل محلی**: نصب از فایل باینری محلی backhaul
- **منبع دانلود جایگزین**: استفاده از منابع دانلود جایگزین در صورت عدم دسترسی به گیت‌هاب
- **تشخیص شبکه**: تست اتصال شبکه و تشخیص مشکلات
- **رد نصب** (پیشرفته): رد نصب باینری برای کاربران پیشرفته

### ۲. منوی اصلی

پس از نصب، منوی زیر را خواهید دید:

```
      EasyBackhaul Management Menu (v14.0-dev)
=================================================================
  Core by Musixal  |  Installer by @N4Xon
-----------------------------------------------------------------

      Main Menu
=================================================================
  1. Configure a New Tunnel
  2. Manage Existing Tunnels
  3. Update/Re-install Backhaul Binary
  4. Generate Self-Signed TLS Certificate
  5. Select Binary Directory
  6. System Health & Performance Monitor
  7. Clean Stale Processes & Temp Files
  8. Uninstall EasyBackhaul
----------------------------------------------------------------
 [?] Help | [r] Return/Back/Cancel | [m] Main Menu | [x] Exit Script
```

### ۳. ساخت تونل جدید

- **پیکربندی سریع (پیشنهادی)**: استفاده از پیش‌فرض‌های منطقی و پرسش فقط سوالات ضروری
- **پیکربندی پیشرفته**: کنترل کامل روی تمام تنظیمات برای کاربران حرفه‌ای
- **انتخاب هوشمند پروتکل**: گزینه‌های ساده‌شده با توضیحات واضح
- **پیکربندی تعاملی پورت**: افزودن قوانین فوروارد پورت به صورت یک به یک با مثال‌های واضح.
- **بررسی خودکار**: بررسی آزاد بودن پورت، اعتبارسنجی IP و تست پینگ اختیاری
- **اعتبارسنجی پیشرفته ورودی**: اعتبارسنجی قوی با پیام‌های خطای مفید

### ۴. مدیریت تونل‌های موجود

#### **منوی مدیریت تونل**
- **شروع/توقف/ریستارت**: کنترل پایه سرویس
- **ریستارت هوشمند**: ریستارت پیشرفته با بررسی سلامت و نظارت بر منابع
- **مشاهده وضعیت سرویس**: خلاصه و لاگ‌های اخیر
- **مشاهده لاگ کامل**: مشاهده تعاملی لاگ با گزینه‌های اسکرول/جستجو/دنبال‌کننده
- **مشاهده کانفیگ**: نمایش کانفیگ فعلی تونل
- **ویرایش کانفیگ**: ویرایش با nano و امکان ریستارت
- **تغییر سطح لاگ**: تغییر سطح لاگ (debug/info/warn/error)
- **تست اتصال**: تست واقعی اتصال شبکه
- **هات‌ریلود کانفیگ**: بارگذاری مجدد کانفیگ بدون ریستارت
- **مدیریت کرون ریستارت خودکار**: تنظیم ریستارت خودکار
- **مدیریت ناظر ریستارت هماهنگ**: هماهنگی پیشرفته ریستارت
- **بررسی سلامت و عملکرد**: نظارت بر سلامت تونل و عملکرد
- **اعتبارسنجی کانفیگ**: اعتبارسنجی جامع کانفیگ
- **حذف سرویس**: حذف تونل و تمام فایل‌های مرتبط

---

## 🧑‍💻 توسعه و ساخت

### **معماری ماژولار**
- تمام منطق در پوشه `modules/` ماژولار شده است
- با اجرای `./build.sh` اسکریپت نهایی `easybh.sh` ساخته می‌شود
- **مستقیم فایل easybh.sh را ویرایش نکنید** — ماژول‌ها را ویرایش و مجدد بسازید

---

## 🧪 کانال توسعه

این نسخه از طریق **کانال توسعه** منتشر شده است.  
لطفاً باگ‌ها و بازخوردها را از طریق [Issues گیت‌هاب](https://github.com/NaxonM/EasyBackhaul/issues) ارسال کنید.

---

## 🙏 سازندگان و حامیان

- **پروژه اصلی Backhaul**: [Musixal](https://github.com/Musixal/Backhaul)
- **اسکریپت EasyBackhaul**: [@N4Xon (NaxonM)](https://github.com/NaxonM/EasyBackhaul) ([تلگرام](https://t.me/N4Xon))

---

## 📄 لایسنس

پروژه اصلی Backhaul تحت لایسنس AGPL-3.0 منتشر شده است.

---

**برای مستندات انگلیسی به [README.md](./README.md) مراجعه کنید.**
